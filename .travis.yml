language: php

dist: xenial

addons:
    apt_packages:
        - parallel

cache:
    directories:
        - $HOME/.composer/cache/files
        - $HOME/symfony-bridge/.phpunit

php:
    - 7.4

env:
    matrix:
        - PREFER_LOWEST="--prefer-lowest"
        - PREFER_LOWEST=""

before_install:
    - composer global require hirak/prestissimo
    - composer update $PREFER_LOWEST

jobs:
    fast_finish: true
    include:
        -   stage: phpcs
            script: ./vendor/bin/phpcs src
        -   stage: tests
            install:
                - pip install --user codecov
            script:
                - ./vendor/bin/simple-phpunit --coverage-clover=coverage.xml
            after_success:
                - bash <(curl -s https://codecov.io/bash)
